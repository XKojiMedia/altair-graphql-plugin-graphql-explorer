import{r as p,j as l,_ as v,C as b,a as L,S as C,b as P,c as S,d as I}from"./square.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const q="plugin-engine::ready",j="plugin::subscribe_to_event",N="plugin::create_action",T="plugin::get_app_style_url",U=r=>`action::${r}`;let g;const W=new Uint8Array(16);function _(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(W)}const c=[];for(let r=0;r<256;++r)c.push((r+256).toString(16).slice(1));function A(r,t=0){return c[r[t+0]]+c[r[t+1]]+c[r[t+2]]+c[r[t+3]]+"-"+c[r[t+4]]+c[r[t+5]]+"-"+c[r[t+6]]+c[r[t+7]]+"-"+c[r[t+8]]+c[r[t+9]]+"-"+c[r[t+10]]+c[r[t+11]]+c[r[t+12]]+c[r[t+13]]+c[r[t+14]]+c[r[t+15]]}const R=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),f={randomUUID:R};function z(r,t,e){if(f.randomUUID&&!t&&!r)return f.randomUUID();r=r||{};const n=r.random||(r.rng||_)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,A(n)}const x=r=>`${r}_response`,E=r=>`${r}_error`;class G{subscribe(t,e){this.onMessage(n=>{n.type===t&&e(t,n)})}request(t,...e){return new Promise((n,i)=>{const s=z();this.onMessage(a=>{switch(a.type){case x(t):return a.payload.id!==s?void 0:n(a.payload.response);case E(t):return a.payload.id!==s?void 0:i(a.payload.error)}}),this.send(t,{id:s,args:e})})}respond(t,e){this.subscribe(t,async(n,i)=>{const{id:s,args:a}=i.payload;try{const d=await e(...a);this.send(x(n),{id:s,response:d})}catch(d){this.send(E(n),{id:s,error:`${d.message??d}`})}})}}const w={MAIN:"main",PANEL:"panel"};class O extends G{constructor(){super(),this.instanceType=w.MAIN;const t=Object.fromEntries(new URLSearchParams(window.location.search));if(this.params=t,!t.sc)throw new Error("Invalid source provided!");if(!t.id)throw new Error("Invalid plugin ID provided!");this.origin=t.sc,this.id=t.id,this.instanceType=t.instanceType??w.MAIN}getInstanceType(){return this.instanceType}getParams(){return this.params}onMessage(t){window.addEventListener("message",e=>{e.origin===this.origin&&t(e.data)})}send(t,e){window.parent.postMessage({type:t,payload:e},this.origin)}onError(t){window.addEventListener("error",t),window.addEventListener("unhandledrejection",e=>{e.preventDefault(),t(e.reason)})}destroy(){window.close()}}class V{constructor(t,e){this.worker=t,this.options=e,this.eventListeners={},this.readyPromise=new Promise(i=>{this.worker.subscribe(q,()=>{i()})});const n=t.getParams().panelName;t.getInstanceType()===w.PANEL&&n&&this.handlePanelSetup(n)}async ready(){await this.readyPromise}canInitialize(){return this.worker.getInstanceType()===w.MAIN}createContext(){const t={getWindowState:(...e)=>this.worker.request("getWindowState",...e),getCurrentWindowState:(...e)=>this.worker.request("getCurrentWindowState",...e),createPanel:async(...e)=>this.worker.request("createPanel",...e),destroyPanel:async(...e)=>this.worker.request("destroyPanel",...e),createAction:async e=>{const n={...e,execute:void 0},s=await this.worker.request(N,n);return s&&this.worker.respond(U(s),async a=>{e.execute(a)}),s},destroyAction:async(...e)=>this.worker.request("destroyAction",...e),isElectron:async(...e)=>!!await this.worker.request("isElectron",...e),createWindow:(...e)=>this.worker.request("createWindow",...e),setQuery:(...e)=>this.worker.request("setQuery",...e),setVariables:(...e)=>this.worker.request("setVariables",...e),setHeader:(...e)=>this.worker.request("setHeader",...e),setEndpoint:(...e)=>this.worker.request("setEndpoint",...e),on:(e,n)=>{this.worker.request(j,e),this.eventListeners[e]=this.eventListeners[e]||[];const i=this.eventListeners[e];return i&&i.push(n),this.worker.respond(e,async(...s)=>{const a=this.eventListeners[e];a&&a.forEach(d=>d(...s))}),{unsubscribe:()=>{this.eventListeners[e]=(this.eventListeners[e]??[]).filter(s=>s!==n)}}},off:()=>{this.eventListeners={},this.worker.request("off")},addTheme:(...e)=>this.worker.request("addTheme",...e),enableTheme:(...e)=>this.worker.request("enableTheme",...e)};return this.ctx=t,t}getContext(){return this.ctx?this.ctx:this.createContext()}async handlePanelSetup(t){const e=this.options.panels[t];e&&e.initialize(this.getContext(),await this.worker.request(T))}}class D{constructor(t={panels:{}}){this.options=t;const e=new O;this.engine=new V(e,this.options),this.initializeWhenReady()}initializeWhenReady(){this.engine.canInitialize()&&this.engine.ready().then(()=>{this.initialize(this.engine.getContext())})}}class M{initialize(t,e){e&&this.setupStyles(e);const n=document.createElement("div");n.id="altair-plugin-panel",document.body.appendChild(n),this.create(t,n)}setupStyles(t){t.styleUrls.forEach(e=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,document.head.appendChild(n)}),this.injectCSS(t.styles.join(`
`)),this.injectCSS(`
      body {
        background: transparent;
      }
    `),t.htmlClasses.forEach(e=>{document.documentElement.classList.add(e)})}injectCSS(t){let e=document.createElement("style");return e.innerText=t,document.head.appendChild(e),e}}const B={keyword:"var(--editor-keyword-color)",def:"var(--editor-def-color)",property:"var(--editor-property-color)",qualifier:"var(--editor-attribute-color)",attribute:"var(--editor-attribute-color)",number:"var(--editor-number-color)",string:"var(--editor-string-color)",builtin:"var(--editor-builtin-color)",string2:"var(--editor-string-color)",variable:"var(--editor-variable-color)",atom:"var(--editor-atom-color)"},Q=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("polyline",{points:"6 9 12 15 18 9"})}),F=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("polyline",{points:"9 18 15 12 9 6"})}),H=()=>l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"3px"},children:[l.jsx("polyline",{points:"9 11 12 14 22 4"}),l.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]}),$=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"3px"},children:l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"})}),k=r=>{let t;if(r)try{t=S(r)}catch{}return t},Y=({context:r})=>{const[t,e]=p.useState({}),[n,i]=p.useState(""),s=(...o)=>console.log(...o),a=o=>r.setQuery(n,o),d=p.useCallback(({windowId:o,data:u})=>{e(h=>({...h,[o]:{...h[o],query:u}}))},[]),y=p.useCallback(({windowId:o,data:u})=>{e(h=>({...h,[o]:{...h[o],sdl:u,schema:k(u)}}))},[]),m=o=>{i(o.windowId),e(u=>({...u,[o.windowId]:{...o,schema:k(o.sdl)}}))};return p.useEffect(()=>(r.getCurrentWindowState().then(o=>{o&&m(o)}),r.on("query.change",d),r.on("sdl.change",y),r.on("current-window.change",async({windowId:o})=>{const u=await r.getWindowState(o);u&&m(u)}),()=>{r.off()}),[r,d,y]),t[n]?l.jsx(v,{schema:t[n].schema,query:t[n].query,onEdit:o=>a(o),explorerIsOpen:!0,onToggleExplorer:s,colors:B,arrowClosed:l.jsx(b,{size:15,style:{marginRight:"3px"}})??F(),arrowOpen:l.jsx(L,{size:15,style:{marginRight:"3px"}})??Q(),checkboxChecked:l.jsx(C,{size:15,style:{marginRight:"3px"}})??H(),checkboxUnchecked:l.jsx(P,{size:15,style:{marginRight:"3px"}})??$()}):null};class K extends M{create(t,e){I(e).render(l.jsx(Y,{context:t}))}}class J extends D{constructor(){super({panels:{"graphql-explorer":new K}})}async initialize(t){console.log("PLUGIN initialize",t),console.log("PLUGIN isElectron",await t.getCurrentWindowState()),t.on("query.change",n=>{console.log("PLUGIN query.change",n)}),await t.createPanel("graphql-explorer");const e=await t.createAction({title:"Test 1",execute(n){console.log("PLUGIN Found me!",n)}});e&&setTimeout(()=>{t.destroyAction(e)},1e3*60)}async destroy(){}}console.log("GraphQLExplorer loaded!");new J;
